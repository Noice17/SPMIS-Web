@* @model SPMIS_Web.Models.ViewModels.UpdateMapViewModel *@
@model SPMIS_Web.Models.Entities.StrategyMap

<form id="updateMapForm" method="post" asp-controller="Map" asp-action="UpdateMap">
    <input type="hidden" name="MapId" value="@Model.MapId" />

    <div class="grid grid-cols-2 gap-4 mb-4">
        <div>
            <label for="MapStart" class="block text-sm font-medium text-gray-700 mb-1">Start Date</label>
            <input type="date" id="MapStart" name="MapStart" value="@Model.MapStart.ToString("yyyy-MM-dd")" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required />
        </div>
        <div>
            <label for="MapEnd" class="block text-sm font-medium text-gray-700 mb-1">End Date</label>
            <input type="date" id="MapEnd" name="MapEnd" value="@Model.MapEnd.ToString("yyyy-MM-dd")" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required />
        </div>
    </div>

    <div class="mb-4">
        <label for="MapTitle" class="block text-sm font-medium text-gray-700 mb-1">Title</label>
        <input type="text" id="MapTitle" name="MapTitle" value="@Model.MapTitle" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required maxlength="100" />
        <span class="text-xs text-gray-500">Maximum 100 characters</span>
    </div>

    <div class="mb-4">
        <label for="MapDescription" class="block text-sm font-medium text-gray-700 mb-1">Description</label>
        <textarea id="MapDescription" name="MapDescription" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">@Model.MapDescription</textarea>
    </div>

    <div class="flex justify-end space-x-3 mt-6">
        <button type="button" id="cancelEditBtn" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 transition duration-200" onclick="closeModal()">
            Cancel
        </button>
        <button type="submit" class="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition duration-200">
            Save Changes
        </button>
    </div>
</form>

<script>
    $(document).ready(function () {
        $("#updateMapForm").submit(function (e) {
            e.preventDefault(); // Prevent default form submission

            var form = $(this);
            var url = form.attr("action");

            $.ajax({
                type: "POST",
                url: url,
                data: form.serialize(),
                success: function (response) {
                    if (response.success) {
                        closeModal(); // Close modal on success
                        location.reload(); // Reload the page
                    } else {
                        alert("Error updating map.");
                    }
                },
                error: function (xhr) {
                    alert("Error: " + xhr.responseText);
                }
            });
        });

        window.closeModal = function () {
            $("#updateMapModal").addClass("hidden").removeClass("flex");
        };
    });
</script>
